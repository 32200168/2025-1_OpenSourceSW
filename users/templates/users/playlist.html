<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Plistory - Playlist</title>
<script src="https://cdn.tailwindcss.com"></script>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&amp;display=swap" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</link></head>
<body class="min-h-screen w-full bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-4 text-white font-sans" style="font-family: 'Noto Sans KR', sans-serif;">
<div class="text-center mt-10 mb-10">
<i class="fas fa-music" style="color: white; font-size: 4em;"></i>
<p class="mt-5 text-gray-100">첫 번째 플레이리스트를 만들어보세요!</p>
</div>
<div class="max-w-3xl mx-auto bg-white/10 backdrop-blur-l rounded-xl p-6 shadow-2xl border border-white">
<!-- Editable Playlist Title + Save Button -->
<div class="flex items-center justify-between mb-4">
<div class="flex items-center space-x-2">
<i class="fas fa-pencil-alt text-white"></i>
<input class="bg-transparent border-white text-white font-semibold text-lg focus:outline-none focus:border-white" id="playlistName" type="text" value="My First Playlist"/>
</div>
</div> <!-- 태그 선택에 연결해야됨!!!-->
<!-- Search Box -->
<div class="relative w-full max-w-full mb-6" id="searchableSelect">
<button class="w-full p-3 text-left text-white bg-white/10 border-2 border-gray-200 rounded-lg focus:ring-white flex items-center justify-between" id="selectButton">
<span id="selectedText">Search Music</span>
<svg class="w-4 h-4 text-white transition-transform duration-200" fill="none" id="selectArrow" stroke="currentColor" viewbox="0 0 24 24">
<path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</button>
<div class="absolute hidden w-full mt-1 bg-[#2d2d2d]/90 border border-gray-300 rounded-lg shadow-lg z-10" id="dropdownMenu">
<div class="p-2">
<input class="w-full p-2 text-sm text-white placeholder-white bg-[#2d2d2d]/70 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-white" id="searchInput" placeholder="곡명 또는 아티스트" type="text"/>
</div>
<ul class="max-h-60 overflow-y-auto py-1" id="optionsList"></ul>
</div>
</div>
<!-- Playlist -->
<ul class="space-y-1 border border-white rounded-lg p-2" id="playlistBox"></ul>
</div>
<!-- 해시태그 -->
<div class="text-lg text-center mt-10"><h2>이 플레이리스트를 표현한다면?</h2></div>
<form action="/users/playlist/" class="mt-5" id="tasteForm" method="POST">
          {% csrf_token %}
        <div class="flex flex-wrap gap-2 justify-center">
<input hidden="" name="hashtags" type="checkbox" value="K-POP"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-pink-500 to-purple-500">
                #K-POP
            </span>
<input hidden="" name="hashtags" type="checkbox" value="랩/힙합"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-green-400 to-blue-500">
                #랩/힙합
            </span>
<input hidden="" name="hashtags" type="checkbox" value="공부할때듣기좋은"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-yellow-400 to-red-500">
                #공부할때듣기좋은
            </span>
<input hidden="" name="hashtags" type="checkbox" value="인디"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-indigo-400 via-purple-400 to-pink-500">
                #인디
            </span>
<input hidden="" name="hashtags" type="checkbox" value="차분한"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-blue-300 via-cyan-400 to-teal-500">
                 #차분한
            </span>
<input hidden="" name="hashtags" type="checkbox" value="잔잔한"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-rose-400 via-pink-400 to-amber-400">
                #잔잔한
            </span>
<input hidden="" name="hashtags" type="checkbox" value="몽환적인"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-violet-300 via-purple-400 to-pink-400">
                #몽환적인
            </span>
<input hidden="" name="hashtags" type="checkbox" value="하우스"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-zinc-400 via-gray-500 to-slate-600">
                #하우스
            </span>
<input hidden="" name="hashtags" type="checkbox" value="락"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-pink-400 via-yellow-300 to-green-300">
                #락
            </span>
<input hidden="" name="hashtags" type="checkbox" value="R&amp;B"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-fuchsia-500 via-violet-500 to-cyan-500">
                #R&amp;B
            </span>
<input hidden="" name="hashtags" type="checkbox" value="어쿠스틱"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-pink-400 via-rose-500 to-red-500">
                #어쿠스틱
            </span>
<input hidden="" name="hashtags" type="checkbox" value="신나는"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-cyan-400 via-sky-400 to-blue-500">
                #신나는
            </span>
<input hidden="" name="hashtags" type="checkbox" value="강렬한"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-lime-400 via-green-400 to-emerald-400">
                #강렬한
            </span>
<input hidden="" name="hashtags" type="checkbox" value="재즈"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-slate-600 via-gray-500 to-zinc-400">
                #재즈
            </span>
<input hidden="" name="hashtags" type="checkbox" value="OST"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-yellow-400 via-amber-500 to-orange-500">
                #OST
            </span>
<input hidden="" name="hashtags" type="checkbox" value="밴드"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-blue-500 via-purple-500 to-pink-500">
                #밴드
            </span>
<input hidden="" name="hashtags" type="checkbox" value="리드미컬한"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-pink-400 via-rose-500 to-red-500">
                #리드미컬한
            </span>
<input hidden="" name="hashtags" type="checkbox" value="EDM"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-lime-400 via-emerald-400 to-green-500">
                #EDM
            </span>
<input hidden="" name="hashtags" type="checkbox" value="펑키한"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-indigo-400 via-purple-400 to-pink-500">
                #펑키한
            </span>
<input hidden="" name="hashtags" type="checkbox" value="로맨틱한"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-pink-500 to-purple-500">
                #로맨틱한
            </span>
<input hidden="" name="hashtags" type="checkbox" value="부드러운"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-cyan-400 via-sky-400 to-blue-500">
                #부드러운
            </span>
<input hidden="" name="hashtags" type="checkbox" value="랩/힙합"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-yellow-400 to-red-500">
                #랩/힙합
            </span>
<input hidden="" name="hashtags" type="checkbox" value="발라드"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-green-400 to-blue-500">
                #발라드
            </span>
<input hidden="" name="hashtags" type="checkbox" value="에너제틱"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-pink-400 via-yellow-300 to-green-300">
                #에너제틱
            </span>
<input hidden="" name="hashtags" type="checkbox" value="여유로운"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-blue-300 via-cyan-400 to-teal-500">
                #여유로운
            </span>
<input hidden="" name="hashtags" type="checkbox" value="수능금지곡"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-rose-400 via-pink-400 to-amber-400">
                #수능금지곡
            </span>
<input hidden="" name="hashtags" type="checkbox" value="새벽감성"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-violet-300 via-purple-400 to-pink-400">
                #새벽감성
            </span>
<input hidden="" name="hashtags" type="checkbox" value="크리스마스"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-zinc-400 via-gray-500 to-slate-600">
                #크리스마스
            </span>
<input hidden="" name="hashtags" type="checkbox" value="카페분위기"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-lime-400 via-emerald-400 to-green-500">
                #카페분위기
            </span>
<input hidden="" name="hashtags" type="checkbox" value="감성적인"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-fuchsia-500 via-violet-500 to-cyan-500">
                #감성적인
            </span>
<input hidden="" name="hashtags" type="checkbox" value="드라이브"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-pink-400 via-rose-500 to-red-500">
                #드라이브
            </span>
<input hidden="" name="hashtags" type="checkbox" value="시티팝"/>
<span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30" data-gradient="from-cyan-400 via-sky-400 to-blue-500">
                #시티팝
            </span>
</div>
<div class="text-center mt-3 mb-20"><button class="mt-10 font-semibold text-white text-xl" type="submit">저장하기</button></div>
</form>



<footer class="fixed bottom-0 left-0 w-full bg-black bg-opacity-30 text-white px-6 py-3">
<div class="flex justify-between items-center">
<a class="text-sm" href="/users/taste">&lt; 이전</a>
<p class="text-sm text-gray-200 text-center flex-1">PL 생성 2/3</p>
<a class="text-sm text-white/0">다음 &gt;</a>
</div>
</footer><script>
document.addEventListener('DOMContentLoaded', function () {
  const selectButton = document.getElementById('selectButton');
  const dropdownMenu = document.getElementById('dropdownMenu');
  const searchInput = document.getElementById('searchInput');
  const optionsList = document.getElementById('optionsList');
  const selectedText = document.getElementById('selectedText');
  const selectArrow = document.getElementById('selectArrow');
  const playlistBox = document.getElementById('playlistBox');
  const form = document.getElementById("tasteForm");

  let playlist = [];

  selectButton.addEventListener('click', () => {
    const isHidden = dropdownMenu.classList.contains('hidden');
    dropdownMenu.classList.toggle('hidden');
    selectArrow.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
    if (!isHidden) searchInput.value = '';
  });

  document.addEventListener('click', (e) => {
    if (!e.target.closest('#searchableSelect')) {
      dropdownMenu.classList.add('hidden');
      selectArrow.style.transform = 'rotate(0deg)';
    }
  });

  searchInput.addEventListener('input', async (e) => {
    const searchTerm = e.target.value.toLowerCase();
    if (searchTerm.length === 0) return;
    const results = await searchSpotify(searchTerm);
    renderOptions(results);
  });

  async function searchSpotify(query) {
    const response = await fetch(`/users/api/search/?q=${encodeURIComponent(query)}`);
    const data = await response.json();
    return data.results;
  }

  function renderOptions(filteredOptions) {
    optionsList.innerHTML = '';
    filteredOptions.forEach(opt => {
      const li = document.createElement('li');
      li.className = 'px-4 py-2 hover:bg-white/10 cursor-pointer';
      li.innerHTML = `
        <div class="flex items-center space-x-2.5">
          <img src="${opt.image}" alt="앨범 아트" class="h-10 w-10 rounded-lg object-cover">
          <div>
            <p class="text-sm font-medium text-white">${opt.title}</p>
            <p class="text-xs text-gray-300">${opt.artist}</p>
          </div>
        </div>
      `;
      li.addEventListener('click', () => {
        selectedText.textContent = opt.title;
        dropdownMenu.classList.add('hidden');
        selectArrow.style.transform = 'rotate(0deg)';
        addToPlaylist(opt);
      });
      optionsList.appendChild(li);
    });
  }

  function addToPlaylist(opt) {
    if (playlist.length >= 10) {
      alert('최대 10곡까지 추가할 수 있습니다.');
      return;
    }
    if (playlist.find(item => item.id === opt.id)) {
      alert('이미 추가된 곡입니다.');
      return;
    }
    playlist.push(opt);

    const li = document.createElement('li');
    li.className = 'bg-gray-200/25 p-2 rounded-lg flex items-center space-x-2';
    li.innerHTML = `
      <img src="${opt.image}" class="h-10 w-10 rounded-lg object-cover" alt="앨범 아트">
      <div>
        <h3 class="text-sm font-semibold">${opt.title}</h3>
        <p class="text-xs text-gray-200">${opt.artist}</p>
      </div>
    `;
    playlistBox.appendChild(li);

    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'song_ids';
    input.value = opt.id;
    form.appendChild(input);
  }
});
</script></body>
</html>
