<!-- templates/main/includes/playlist_content.html -->

<div class="text-center mb-10">
    <i class="fas fa-music" style="color: white; font-size: 5em;"></i>
    <p class="mt-5 text-2xl font-bold text-white tracking-tighter style=" letter-spacing: -0.1em;">
        <span class="inline-block animate-[wave_2s_ease-in-out_infinite]"
            style="animation: wave 2s ease-in-out infinite;">플</span>
        <span class="inline-block animate-[wave_2s_ease-in-out_infinite_0.1s]"
            style="animation: wave 2s ease-in-out infinite 0.1s;">레</span>
        <span class="inline-block animate-[wave_2s_ease-in-out_infinite_0.2s]"
            style="animation: wave 2s ease-in-out infinite 0.2s;">이</span>
        <span class="inline-block animate-[wave_2s_ease-in-out_infinite_0.3s]"
            style="animation: wave 2s ease-in-out infinite 0.3s;">리</span>
        <span class="inline-block animate-[wave_2s_ease-in-out_infinite_0.4s]"
            style="animation: wave 2s ease-in-out infinite 0.4s;">스</span>
        <span class="inline-block animate-[wave_2s_ease-in-out_infinite_0.5s]"
            style="animation: wave 2s ease-in-out infinite 0.5s;">트</span>
        <span class="inline-block animate-[wave_2s_ease-in-out_infinite_0.6s]"
            style="animation: wave 2s ease-in-out infinite 0.6s;"> </span>
        <span class="inline-block animate-[wave_2s_ease-in-out_infinite_0.7s]"
            style="animation: wave 2s ease-in-out infinite 0.7s;">생</span>
        <span class="inline-block animate-[wave_2s_ease-in-out_infinite_0.8s]"
            style="animation: wave 2s ease-in-out infinite 0.8s;">성</span>
    </p>
    <style>
        @keyframes wave {

            30%,
            70% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }
    </style>
</div>

<form id="tasteForm" method="POST" action="{% url 'create_playlist' %}">
    {% csrf_token %}

    <div class="max-w-3xl text-white mx-auto bg-white/10 backdrop-blur-l rounded-xl p-6 shadow-2xl border border-white">
        <!-- Editable Playlist Title -->
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-2">
                <i class="fas fa-pencil-alt text-white"></i>
                <input id="playlistName" name="playlistName" type="text" value="My Playlist"
                    class="bg-transparent border-white text-white font-semibold text-lg focus:outline-none focus:border-white" />
            </div>
        </div> <!-- 태그 선택 페이지에 연결 -->


        <!-- Search Box -->
        <div class="relative w-full max-w-full text-white mb-6" id="searchableSelect">
            <button
                class="w-full p-3 text-left text-white bg-white/10 border-2 border-gray-200 rounded-lg focus:ring-white flex items-center justify-between"
                id="selectButton" type="button">
                <span id="selectedText" class="text-white">Search Music</span>
                <svg class="w-4 h-4 text-white transition-transform duration-200" fill="none" id="selectArrow"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" />
                </svg>
            </button>
            <div class="absolute hidden w-full mt-1 bg-[#2d2d2d]/90 border border-gray-300 rounded-lg shadow-lg z-10"
                id="dropdownMenu">
                <div class="p-2">
                    <input id="searchInput" type="text" placeholder="곡명 또는 아티스트"
                        class="w-full p-2 text-sm text-white placeholder-white bg-[#2d2d2d]/70 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-white" />
                </div>
                <ul class="max-h-60 overflow-y-auto py-1" id="optionsList"></ul>
                <input type="hidden" name="playlistData" id="playlistData">
            </div>
        </div>

        <!-- Playlist -->
        <ul id="playlistBox" class="space-y-1 border border-white rounded-lg p-2"></ul>
    </div>


    <!-- 해시태그 -->
    <div class="text-lg text-white text-center mt-10 mb-10">
        <h2>이 플레이리스트를 표현한다면?</h2>
    </div>

    <div class="flex flex-wrap gap-2 justify-center">
        <input type="checkbox" name="hashtags" value="K-POP" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-500 to-purple-500">
            #K-POP
        </span>
        <input type="checkbox" name="hashtags" value="랩/힙합" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-green-400 to-blue-500">
            #랩/힙합
        </span>
        <input type="checkbox" name="hashtags" value="댄스" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-fuchsia-500 via-violet-500 to-cyan-500">
            #댄스
        </span>
        <input type="checkbox" name="hashtags" value="인디" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-violet-300 via-purple-400 to-pink-400">
            #인디
        </span>
        <input type="checkbox" name="hashtags" value="해외팝" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-yellow-400 to-red-500">
            #해외팝
        </span>


        <input type="checkbox" name="hashtags" value="락" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-indigo-400 via-purple-400 to-pink-500">
            #락
        </span>
        <input type="checkbox" name="hashtags" value="R&B" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-blue-300 via-cyan-400 to-teal-500">
            #R&B
        </span>
        <input type="checkbox" name="hashtags" value="재즈" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-rose-400 via-pink-400 to-amber-400">
            #어쿠스틱
        </span>
        <input type="checkbox" name="hashtags" value="몽환적인" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-violet-300 via-purple-400 to-pink-400">
            #재즈
        </span>
        <input type="checkbox" name="hashtags" value="밴드" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-zinc-400 via-gray-500 to-slate-600">
            #밴드
        </span>


        <input type="checkbox" name="hashtags" value="EDM" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-400 to-green-300">
            #EDM
        </span>
        <input type="checkbox" name="hashtags" value="발라드" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-fuchsia-500 via-violet-500 to-cyan-500">
            #발라드
        </span>
        <input type="checkbox" name="hashtags" value="시티팝" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-400 via-rose-500 to-red-500">
            #시티팝
        </span>
        <input type="checkbox" name="hashtags" value="잔잔한" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-cyan-400 via-sky-400 to-blue-500">
            #잔잔한
        </span>
        <input type="checkbox" name="hashtags" value="몽환적인" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-lime-400 via-green-400 to-emerald-400">
            #몽환적인
        </span>


        <input type="checkbox" name="hashtags" value="강렬한" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-slate-600 via-gray-500 to-zinc-400">
            #강렬한
        </span>
        <input type="checkbox" name="hashtags" value="신나는" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-400 via-rose-500 to-red-500">
            #신나는
        </span>
        <input type="checkbox" name="hashtags" value="리드미컬" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-yellow-400 via-amber-500 to-orange-500">
            #리드미컬
        </span>
        <input type="checkbox" name="hashtags" value="로맨틱" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-blue-500 via-purple-500 to-pink-500">
            #청량한
        </span>
        <input type="checkbox" name="hashtags" value="로맨틱" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-400 via-rose-500 to-red-500">
            #로맨틱
        </span>


        <input type="checkbox" name="hashtags" value="따뜻한" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-lime-400 via-emerald-400 to-green-500">
            #따뜻한
        </span>
        <input type="checkbox" name="hashtags" value="사랑" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-indigo-400 via-purple-400 to-pink-500">
            #사랑
        </span>
        <input type="checkbox" name="hashtags" value="이별" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-green-400 to-blue-500">
            #이별
        </span>
        <input type="checkbox" name="hashtags" value="공부" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-500 to-purple-500">
            #공부
        </span>
        <input type="checkbox" name="hashtags" value="운동" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-cyan-400 via-sky-400 to-blue-500">
            #운동
        </span>


        <input type="checkbox" name="hashtags" value="러닝" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-yellow-400 to-red-500">
            #러닝
        </span>
        <input type="checkbox" name="hashtags" value="여행" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-green-400 to-blue-500">
            #여행
        </span>
        <input type="checkbox" name="hashtags" value="힐링" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-400 to-green-300">
            #힐링
        </span>
        <input type="checkbox" name="hashtags" value="노동요" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-blue-300 via-cyan-400 to-teal-500">
            #노동요
        </span>
        <input type="checkbox" name="hashtags" value="카페감성" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-rose-400 via-pink-400 to-amber-400">
            #카페감성
        </span>


        <input type="checkbox" name="hashtags" value="비오는날" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-violet-300 via-purple-400 to-pink-400">
            #비오는날
        </span>
        <input type="checkbox" name="hashtags" value="잠들기전" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-zinc-400 via-gray-500 to-slate-600">
            #잠들기전
        </span>
        <input type="checkbox" name="hashtags" value="출근길" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-lime-400 via-emerald-400 to-green-500">
            #출근길
        </span>
        <input type="checkbox" name="hashtags" value="드라이브" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-fuchsia-500 via-violet-500 to-cyan-500">
            #드라이브
        </span>
        <input type="checkbox" name="hashtags" value="새벽감성" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-400 via-rose-500 to-red-500">
            #새벽감성
        </span>


        <input type="checkbox" name="hashtags" value="추억여행" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-cyan-400 via-sky-400 to-blue-500">
            #추억여행
        </span>
        <input type="checkbox" name="hashtags" value="수능금지곡" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-lime-400 via-green-400 to-emerald-400">
            #수능금지곡
        </span>
        <input type="checkbox" name="hashtags" value="숨듣명" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-rose-400 via-pink-400 to-amber-400">
            #숨듣명
        </span>
        <input type="checkbox" name="hashtags" value="봄" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-fuchsia-500 via-violet-500 to-cyan-500">
            #봄
        </span>
        <input type="checkbox" name="hashtags" value="여름" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-500 to-purple-500">
            #여름
        </span>


        <input type="checkbox" name="hashtags" value="가을" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-blue-300 via-cyan-400 to-teal-500">
            #가을
        </span>
        <input type="checkbox" name="hashtags" value="겨울" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-yellow-400 to-red-500">
            #겨울
        </span>
        <input type="checkbox" name="hashtags" value="크리스마스" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-zinc-400 via-gray-500 to-slate-600">
            #크리스마스
        </span>
        <input type="checkbox" name="hashtags" value="영화" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-400 via-rose-500 to-red-500">
            #영화
        </span>
        <input type="checkbox" name="hashtags" value="드라마" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-pink-400 via-gold-300 to-green-300">
            #드라마
        </span>


        <input type="checkbox" name="hashtags" value="애니메이션" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-yellow-400 to-red-500">
            #애니메이션
        </span>
        <input type="checkbox" name="hashtags" value="OST" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-blue-300 via-cyan-400 to-teal-500">
            #OST
        </span>
        <input type="checkbox" name="hashtags" value="2000년대" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-zinc-400 via-gray-500 to-slate-600">
            #2000년대
        </span>
        <input type="checkbox" name="hashtags" value="2010년대" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-lime-400 via-emerald-400 to-green-500">
            #2010년대
        </span>
        <input type="checkbox" name="hashtags" value="여행" hidden>
        <span class="tag px-4 py-1 rounded-full text-white font-medium cursor-pointer bg-white bg-opacity-30"
            data-gradient="from-fuchsia-500 via-violet-500 to-cyan-500">
            #2020년대
        </span>
    </div>

    {% if error %}
    <p class="text-red-500 text-center my-2 text-sm">{{ error }}</p>
    {% endif %}

    <div class="text-center mt-3 mb-20">
        <button type="submit" class="mt-10 font-semibold text-white text-xl">저장하기</button>
    </div>

    </div>
</form>

<script>
    const searchInput = document.getElementById('searchInput');
    const optionsList = document.getElementById('optionsList');
    const selectedText = document.getElementById('selectedText');
    const dropdownMenu = document.getElementById('dropdownMenu');
    const selectArrow = document.getElementById('selectArrow');

    // ⭐ 검색창에 포커스되면 드롭다운 메뉴 열기
    searchInput.addEventListener('focus', () => {
        dropdownMenu.classList.remove('hidden');
        selectArrow.style.transform = 'rotate(180deg)';
    });

    searchInput.addEventListener('input', async (e) => {
        const query = e.target.value.trim();
        if (!query) {
            renderOptions([]);
            return;
        }
        const results = await searchSpotify(query);
        renderOptions(results);
    });

    async function searchSpotify(query) {
        const response = await fetch('/main/api/search/?q=' + encodeURIComponent(query));
        const data = await response.json();
        return data.results;
    }

    function renderOptions(filteredOptions) {
        optionsList.innerHTML = '';
        filteredOptions.forEach(opt => {
            const li = document.createElement('li');
            li.className = 'px-4 py-2 hover:bg-white/10 cursor-pointer';
            li.innerHTML = `
            <div class="flex items-center space-x-2.5">
                <img src="${opt.image}" alt="앨범 아트" class="h-10 w-10 rounded-lg object-cover">
                <div>
                    <p class="text-sm font-medium text-white">${opt.title}</p>
                    <p class="text-xs text-gray-300">${opt.artist}</p>
                </div>
            </div>
        `;
            li.addEventListener('click', () => {
                selectedText.textContent = opt.title;
                dropdownMenu.classList.add('hidden');
                selectArrow.style.transform = 'rotate(0deg)';
                addToPlaylist(opt);
            });
            optionsList.appendChild(li);
        });
    }

    // ⭐ 필수: 실제로 곡을 플레이리스트에 추가하는 함수(예시)
    function addToPlaylist(opt) {
        const playlistBox = document.getElementById('playlistBox');
        const li = document.createElement('li');
        li.className = 'bg-gray-200/25 p-2 rounded-lg flex items-center space-x-2';
        li.innerHTML = `
        <img src="${opt.image}" class="h-10 w-10 rounded-lg object-cover" alt="앨범 아트">
        <div>
            <h3 class="text-sm font-semibold">${opt.title}</h3>
            <p class="text-xs text-gray-200">${opt.artist}</p>
        </div>
    `;
        playlistBox.appendChild(li);

        window.playlist.push({
            id: opt.id,         // 필수: 곡의 DB id
            title: opt.title,
            artist: opt.artist,
            image: opt.image
        });

        // 추가로 곡 데이터를 히든 input에 넣어주는 코드도 작성 필요(기능에 따라)
    }

    form.addEventListener("submit", function (e) {
        // 유효성 검사(3곡 이상, 해시태그 3개 이상) 생략
        playlistInput.value = JSON.stringify(window.playlist);
    });

</script>