{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Plistory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    crossorigin="anonymous"
  />
</head>
<body class="min-h-screen w-full bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-4" style="font-family: 'Noto Sans KR', sans-serif;">

  <div>

  <!-- 상단 콘텐츠 -->
    <div class="content space-y-6">

      <!--피드 탭-->
      <div id="feed" class="tab-content active">📸 피드 페이지</div>

      <!--추천 탭-->
      <div id="recom" class="tab-content">🔲 플레이리스트 추천 페이지</div>

      <!--플리 생성 탭-->
      <div id="add" class="tab-content">
        {% include "main/includes/playlist_content.html" %}
      </div>

      <!--프로필 탭-->
      <div id="profile" class="tab-content">
        <div class="w-full max-w-3xl p-5 bg-white/20 dark:bg-gray-800 rounded-lg shadow">
          <div class="flex items-start gap-6">
            <!-- 프로필 이미지 -->
            <img src="{% static 'profile_pic/default.jpg' %}" alt="profile"
                class="w-24 h-24 rounded-lg object-cover">

            <!-- 오른쪽 정보 -->
            <div class="flex-1 text-left">
              <!-- 사용자 이름 -->
              <h2 class="text-3xl font-semibold text-white">@{{ request.user.username }}</h2>

              <!-- 팔로잉/팔로워 -->
              <div class="flex gap-6 mt-1">
                <div>
                  <p class="text-lg font-bold text-white">3</p>
                  <p class="text-gray-200 dark:text-gray-400 text-sm">Playlists</p>
                </div>
                <div>
                  <p class="text-lg font-bold text-white">12</p>
                  <p class="text-gray-200 dark:text-gray-400 text-sm">Followers</p>
                </div>
                <div>
                  <p class="text-lg font-bold text-white">8</p>
                  <p class="text-gray-200 dark:text-gray-400 text-sm">Following</p>
                </div>
              </div>
            </div>
          </div>

          <!-- 수정 버튼 -->
          <div class="mt-5 mb-2 text-left">
            <a href="{% url 'profile_edit' %}" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 text-black dark:text-white rounded hover:bg-gray-300 dark:hover:bg-gray-600">
              Edit Profile
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>



  <!-- 하단 탭 -->
  <div class="fixed bottom-0 left-0 right-0 flex h-16 z-50">
    <button onclick="showTab('feed')" class="tab-btn w-1/4 flex justify-center items-center bg-transparent border-none outline-none focus:outline-none active:bg-transparent appearance-none">
      <img src="{% static 'icons/home.png' %}" alt="Home" class="tab-icon w-8 h-8">
    </button>
    <button onclick="showTab('recom')" class="tab-btn w-1/4 flex justify-center items-center bg-transparent border-none outline-none focus:outline-none active:bg-transparent appearance-none">
      <img src="{% static 'icons/search.png' %}" alt="Search" class="tab-icon w-9 h-9">
    </button>
    <button onclick="showTab('add')" class="tab-btn w-1/4 flex justify-center items-center">
      <img src="{% static 'icons/add.png' %}" alt="Add" class="tab-icon w-9 h-9">
    </button>
    <button onclick="showTab('profile')" class="tab-btn w-1/4 flex justify-center items-center bg-transparent border-none outline-none focus:outline-none active:bg-transparent appearance-none">
      <img src="{% static 'icons/profile.png' %}" alt="Profile" class="tab-icon w-8 h-8">
    </button>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function () {
    const selectButton = document.getElementById('selectButton');
    const dropdownMenu = document.getElementById('dropdownMenu');
    const searchInput = document.getElementById('searchInput');
    const optionsList = document.getElementById('optionsList');
    const selectedText = document.getElementById('selectedText');
    const selectArrow = document.getElementById('selectArrow');
    const playlistBox = document.getElementById('playlistBox');

    const options = [
      { id: 1, title: '노래 제목 A', artist: '아티스트 A' },
      { id: 2, title: '노래 제목 B', artist: '아티스트 B' },
      { id: 3, title: '노래 제목 C', artist: '아티스트 C' }
    ];

    selectButton.addEventListener('click', () => {
      const isHidden = dropdownMenu.classList.contains('hidden');
      dropdownMenu.classList.toggle('hidden');
      selectArrow.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
      if (!isHidden) searchInput.value = '';
      renderOptions(options);
    });

    document.addEventListener('click', (e) => {
      if (!e.target.closest('#searchableSelect')) {
        dropdownMenu.classList.add('hidden');
        selectArrow.style.transform = 'rotate(0deg)';
      }
    });

    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      const filtered = options.filter(o =>
        o.title.toLowerCase().includes(searchTerm) ||
        o.artist.toLowerCase().includes(searchTerm)
      );
      renderOptions(filtered);
    });

    function renderOptions(filteredOptions) {
      optionsList.innerHTML = '';
      filteredOptions.forEach(opt => {
        const li = document.createElement('li');
        li.className = 'px-4 py-2 hover:bg-white/10 cursor-pointer';
        li.innerHTML = `
          <div class="flex items-center space-x-2.5">
            <img src="https://cdn.startupful.io/img/app_logo/no_img.png" alt="앨범 아트" class="h-10 w-10 rounded-lg object-cover">
            <div>
              <p class="text-sm font-medium text-white">${opt.title}</p>
              <p class="text-xs text-gray-300">${opt.artist}</p>
            </div>
          </div>
        `;
        li.addEventListener('click', () => {
          selectedText.textContent = opt.title;
          dropdownMenu.classList.add('hidden');
          selectArrow.style.transform = 'rotate(0deg)';
          addToPlaylist(opt);
        });
        optionsList.appendChild(li);
      });
    }

    function addToPlaylist(opt) {
      if (typeof playlist === 'undefined') window.playlist = [];
      if (playlist.length >= 10) {
        alert('최대 10곡까지 추가할 수 있습니다.');
        return;
      }
      if (playlist.find(item => item.title === opt.title && item.artist === opt.artist)) {
        alert('이미 추가된 곡입니다.');
        return;
      }
      playlist.push(opt);

      const li = document.createElement('li');
      li.className = 'bg-gray-200/25 p-2 rounded-lg flex items-center space-x-2';
      li.innerHTML = `
        <img src="https://cdn.startupful.io/img/app_logo/no_img.png" class="h-10 w-10 rounded-lg object-cover" alt="앨범 아트">
        <div>
          <h3 class="text-sm font-semibold">${opt.title}</h3>
          <p class="text-xs text-gray-200">${opt.artist}</p>
        </div>
       `;
        playlistBox.appendChild(li);
      }

      renderOptions(options);
    });
  </script>

  <script>
document.addEventListener("DOMContentLoaded", function () {
  const tags = document.querySelectorAll(".tag");
  const checkboxes = document.querySelectorAll('input[type="checkbox"][name="hashtags"]');
  const form = document.getElementById("tasteForm");

  tags.forEach((tag, index) => {
    const checkbox = checkboxes[index];
    const gradient = tag.dataset.gradient.split(" ");
    tag.addEventListener("click", () => {
      const isActive = tag.classList.contains("bg-gradient-to-r");
      tag.classList.remove("bg-white", "bg-opacity-30", "bg-gradient-to-r", ...gradient);
      if (!isActive) {
        tag.classList.add("bg-gradient-to-r", ...gradient);
      } else {
        tag.classList.add("bg-white", "bg-opacity-30");
      }
      checkbox.checked = !isActive;
    });
  });

  form.addEventListener("submit", function (e) {
    const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
    if (selectedCount < 3) {
      e.preventDefault();
      alert("최소 3개의 해시태그를 선택해주세요.");
    }
  });
});
</script>


  <script>
    function showTab(tabId) {
      // 콘텐츠 전환
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');

      // 모든 아이콘 흑백으로 초기화
      document.querySelectorAll('.tab-icon').forEach(img => img.classList.remove('invert'));

      // 클릭한 버튼의 아이콘만 invert 추가
      event.currentTarget.querySelector('.tab-icon').classList.add('invert');
    }
  </script>


  <style>
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>

</body>
</html>
